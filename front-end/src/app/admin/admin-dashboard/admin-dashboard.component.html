<div>
  <app-header [isAdmin]="true"></app-header>
</div>
<div class="p-grid p-dir-col">
  <div class="p-col-12">
    <p-tabView>
      <p-tabPanel header="Products">
        <div class="d-flex justify-content-end mb-2">
          <button pButton icon="pi pi-plus" label="Create Product" (click)="createProduct()"></button>
        </div>
        <div class="p-grid p-dir-col">
          <div class="p-col-12">
            <p-table [value]="products" [rows]="10" [paginator]="true" [responsive]="true">
              <ng-template pTemplate="header">
                <tr>
                  <th>Image</th>
                  <th>Product Name</th>
                  <th>Category</th>
                  <th>Description</th>
                  <th>Price</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-product>
                <tr>
                  <td>
                    <ng-container *ngIf="product.productImageUrl; else defaultIcon">
                      <img [src]="product.productImageUrl" alt="{{ product.productName }}" height="50">
                    </ng-container>
                    <ng-template #defaultIcon>
                      <i class="pi pi-image" style="font-size: 2em;"></i>
                    </ng-template>
                  </td>
                  <td>{{ product.productName }}</td>
                  <td>{{ getCategoryNameById(product.categoryId) }}</td>
                  <td>{{ product.productDescription }}</td>
                  <td>{{ product.productPrice | currency:'INR':'symbol' }}</td>
                  <td style="width: 150px;">
                    <button pButton icon="pi pi-pencil" (click)="editProduct(product)" class="p-button-rounded p-button-info me-2"></button>
                    <button pButton icon="pi pi-trash" (click)="deleteProduct(product)" class="p-button-rounded p-button-danger"></button>
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Categories">
        <div class="d-flex justify-content-end mb-2">
          <button pButton icon="pi pi-plus" label="Create Category" (click)="createCategory()"></button>
        </div>
        <div class="p-grid p-dir-col">
          <div class="p-col-12">
            <p-table [value]="categories" [rows]="10" [paginator]="true" [responsive]="true">
              <ng-template pTemplate="header">
                <tr>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Actions</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-category>
                <tr>
                  <td>
                    <ng-container *ngIf="category.imageUrl; else defaultIcon">
                      <img [src]="category.imageUrl" alt="{{ category.name }}" height="50">
                    </ng-container>
                    <ng-template #defaultIcon>
                      <i class="pi pi-image" style="font-size: 2em;"></i>
                    </ng-template>
                  </td>
                  <td>{{ category.name }}</td>
                  <td>{{ category.description }}</td>
                  <td>
                    <button pButton icon="pi pi-pencil" (click)="editCategory(category)" class="p-button-rounded p-button-info me-2"></button>
                    <!-- <button pButton icon="pi pi-trash" (click)="deleteCategory(category)" class="p-button-rounded p-button-danger"></button> -->
                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-tabPanel>
      <p-tabPanel header="Users(WIP)">
        <div class="p-grid p-dir-col">
          <div class="p-col-12">
            <p-table [value]="users" [rows]="10" [paginator]="true">
              <ng-template pTemplate="header">
                <tr>
                  <th>Username</th>
                  <th>Status</th>
                  <!-- <th>Actions</th> -->
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-user>
                <tr>
                  <td>{{ user.username }}</td>
                  <td>
                    <span [ngClass]="{'status-dot': true, 'active': user.isActive, 'inactive': !user.isActive}"></span>
                    {{user.isActive ? 'Active' : 'Inactive'}} (WIP - Dummy for now)
                  </td>
                  <!-- <td>
                    <button pButton (click)="toggleUserStatus(user)">{{user.isActive ? 'Deactivate': 'Activate'}}</button>
                  </td> -->
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>

<!-- Product Dialog -->
<p-dialog header="Product" *ngIf="productDialog.isOpen" [(visible)]="productDialog.isOpen" [modal]="true" [closable]="false" [style]="{'width': '40vw'}" [baseZIndex]="10000">
  <div class="" *ngIf="productDialog.product">
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="productName">Product Name</label>
      <input id="productName" pInputText [(ngModel)]="productDialog.product.productName" />
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="productDescription">Description</label>
      <textarea id="productDescription" pInputTextarea [(ngModel)]="productDialog.product.productDescription" ></textarea>
    </div>
    <div class="d-flex flex-column gap-3 mb-3">
      <label for="productPrice">Price</label>
      <input id="productPrice" pInputText type="number" [(ngModel)]="productDialog.product.productPrice" />
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="productCategory">Category</label>
      <p-dropdown
        id="category"
        [options]="categories"
        [(ngModel)]="productDialog.product.categoryId"
        optionLabel="name"
        optionValue="id"
        placeholder="Select a Category">
      </p-dropdown>
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="productType">Product Type</label>
      <p-dropdown
        id="productType"
        [options]="productTypes"
        [(ngModel)]="productDialog.product.productTypeId"
        optionLabel="name"
        optionValue="id"
        placeholder="Select a Product Type">
      </p-dropdown>
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="productBrands">Brand</label>
      <p-dropdown
        id="productBrand"
        [options]="productBrands"
        [(ngModel)]="productDialog.product.brandNameId"
        optionLabel="name"
        optionValue="id"
        placeholder="Select a Brand">
      </p-dropdown>
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="productImage">Image</label>
      <ng-container *ngIf="productDialog.product.productImageUrl; else defaultIcon">
        <img [src]="productDialog.product.productImageUrl" alt="{{ productDialog.product.productName }}" width="50" height="auto">
      </ng-container>
      <ng-template #defaultIcon>
        <i class="pi pi-image" style="font-size: 2em;"></i>
      </ng-template>
      <input id="productImage" type="file" (change)="onFileChange($event)" />
    </div>
    <p-footer>
      <div class="d-flex justify-content-end gap-2">
        <button pButton class="p-button-rounded p-button-secondary me-2" label="Cancel" icon="pi pi-times" (click)="hideDialog()"></button>
        <button pButton class="p-button-rounded p-button-info" label="Save" icon="pi pi-check" (click)="saveProduct()" class="p-mr-2"></button>
      </div>
    </p-footer>
  </div>
</p-dialog>

<!-- Category Dialog -->
<p-dialog header="Category" *ngIf="categoryDialog.isOpen" [(visible)]="categoryDialog.isOpen" [modal]="true" [closable]="false" [style]="{'width': '30vw'}" [baseZIndex]="10000">
  <div class="" *ngIf="categoryDialog.category">
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="categoryName">Category Name</label>
      <input id="categoryName" pInputText [(ngModel)]="categoryDialog.category.name" />
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="categoryDescription">Description</label>
      <textarea id="categoryDescription" pInputTextarea [(ngModel)]="categoryDialog.category.description"></textarea>
    </div>
    <div class="d-flex flex-column gap-2 mb-3">
      <label for="categoryImage">Image</label>
      <ng-container *ngIf="categoryDialog.category.imageUrl; else defaultIcon">
        <img [src]="categoryDialog.category.imageUrl" alt="{{ categoryDialog.category.name }}" width="50" height="auto">
      </ng-container>
      <ng-template #defaultIcon>
        <i class="pi pi-image" style="font-size: 2em;"></i>
      </ng-template>
      <input id="categoryImage" type="file" (change)="onFileChange($event)" />
    </div>
    <p-footer>
      <div class="d-flex justify-content-end gap-2">
        <button pButton class="p-button-rounded p-button-secondary me-2" label="Cancel" icon="pi pi-times" (click)="hideDialog()"></button>
        <button pButton class="p-button-rounded p-button-info" label="Save" icon="pi pi-check" (click)="saveCategory()" class="p-mr-2"></button>
      </div>
    </p-footer>
  </div>
</p-dialog>

<div>
  <app-footer></app-footer>
</div>
